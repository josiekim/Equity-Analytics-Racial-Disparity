<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Here we provide a detailed analysis using more sophisticated statistics techniques.">

<title>MA [46]15 Final Project — TEAM 12 - Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project — TEAM 12</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./big_picture.html"> 
<span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analysis.html" aria-current="page"> 
<span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html"> 
<span class="menu-text">Data</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#distribution-of-average-coi-z-score-by-region" id="toc-distribution-of-average-coi-z-score-by-region" class="nav-link active" data-scroll-target="#distribution-of-average-coi-z-score-by-region">Distribution of Average COI Z-Score by Region</a></li>
  <li><a href="#social-and-economic-factors" id="toc-social-and-economic-factors" class="nav-link" data-scroll-target="#social-and-economic-factors">Social and Economic Factors</a>
  <ul class="collapse">
  <li><a href="#key-indicators-of-se-factors-in-northeast-region" id="toc-key-indicators-of-se-factors-in-northeast-region" class="nav-link" data-scroll-target="#key-indicators-of-se-factors-in-northeast-region">Key Indicators of SE Factors in Northeast Region</a></li>
  <li><a href="#key-indicators-of-se-factors-in-south-region" id="toc-key-indicators-of-se-factors-in-south-region" class="nav-link" data-scroll-target="#key-indicators-of-se-factors-in-south-region">Key Indicators of SE Factors in South Region</a></li>
  <li><a href="#linear-models-for-weighted-average-of-social-and-economic-domain-z-scores-nationally-normed" id="toc-linear-models-for-weighted-average-of-social-and-economic-domain-z-scores-nationally-normed" class="nav-link" data-scroll-target="#linear-models-for-weighted-average-of-social-and-economic-domain-z-scores-nationally-normed">Linear Models for Weighted Average of Social and Economic Domain z-scores, Nationally Normed</a></li>
  </ul></li>
  <li><a href="#education-domain-factors" id="toc-education-domain-factors" class="nav-link" data-scroll-target="#education-domain-factors">Education Domain Factors</a>
  <ul class="collapse">
  <li><a href="#key-indicators-of-ed-factors-in-northeast-region" id="toc-key-indicators-of-ed-factors-in-northeast-region" class="nav-link" data-scroll-target="#key-indicators-of-ed-factors-in-northeast-region">Key Indicators of ED Factors in Northeast Region</a></li>
  <li><a href="#key-indicators-of-ed-factors-in-south-region" id="toc-key-indicators-of-ed-factors-in-south-region" class="nav-link" data-scroll-target="#key-indicators-of-ed-factors-in-south-region"><img src="images/clipboard-764707238.png" class="img-fluid">Key Indicators of ED Factors in South Region</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><img src="images/clipboard-123417509.png" class="img-fluid"></a></li>
  <li><a href="#linear-models-for-weighted-average-of-education-domain-z-scores-nationally-normed" id="toc-linear-models-for-weighted-average-of-education-domain-z-scores-nationally-normed" class="nav-link" data-scroll-target="#linear-models-for-weighted-average-of-education-domain-z-scores-nationally-normed">Linear Models for Weighted Average of Education Domain z-scores, Nationally Normed</a></li>
  </ul></li>
  <li><a href="#health-and-environment-factors" id="toc-health-and-environment-factors" class="nav-link" data-scroll-target="#health-and-environment-factors">Health and Environment Factors</a>
  <ul class="collapse">
  <li><a href="#key-indicators-of-he-factors-in-northeast-region" id="toc-key-indicators-of-he-factors-in-northeast-region" class="nav-link" data-scroll-target="#key-indicators-of-he-factors-in-northeast-region">Key Indicators of HE Factors in Northeast Region</a></li>
  <li><a href="#key-indicators-of-he-factors-in-south-region" id="toc-key-indicators-of-he-factors-in-south-region" class="nav-link" data-scroll-target="#key-indicators-of-he-factors-in-south-region">Key Indicators of HE Factors in South Region</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><img src="images/clipboard-2315424768.png" class="img-fluid"></a></li>
  <li><a href="#linear-models-for-weighted-average-of-health-and-economic-domain-z-scores-nationally-normed" id="toc-linear-models-for-weighted-average-of-health-and-economic-domain-z-scores-nationally-normed" class="nav-link" data-scroll-target="#linear-models-for-weighted-average-of-health-and-economic-domain-z-scores-nationally-normed">Linear Models for Weighted Average of Health and Economic Domain z-scores, Nationally Normed</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis</h1>
</div>

<div>
  <div class="description">
    Here we provide a detailed analysis using more sophisticated statistics techniques.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="images/clipboard-2562157356.png" class="img-fluid" width="702"></p>
<p>We are interested in seeing how the distribution of z-scores varies across the United States. So we decided to split the cleaned data into regions rather than state by using the <code>case_when()</code> function. Organizing the data by region facilitates easier comparisons and provides a clearer understanding of the <code>z_COI_nat`</code> trends. We chose to create a bar graph of the weighted averages of the <code>z_COI_nat</code> data by region.</p>
<section id="distribution-of-average-coi-z-score-by-region" class="level1">
<h1>Distribution of Average COI Z-Score by Region</h1>
<p><img src="images/clipboard-1922571005.png" class="img-fluid"></p>
<p>Since the Northeast region has the highest mean z-score and South has the lowest, we are focusing our analysis on these 2 regions. By graphing histograms and various linear models, we are interested in seeing how social and economic, health and environment, and education factors impact COI scores.</p>
</section>
<section id="social-and-economic-factors" class="level1">
<h1>Social and Economic Factors</h1>
<section id="key-indicators-of-se-factors-in-northeast-region" class="level2">
<h2 class="anchored" data-anchor-id="key-indicators-of-se-factors-in-northeast-region">Key Indicators of SE Factors in Northeast Region</h2>
<p><img src="images/clipboard-2311506481.png" class="img-fluid"></p>
</section>
<section id="key-indicators-of-se-factors-in-south-region" class="level2">
<h2 class="anchored" data-anchor-id="key-indicators-of-se-factors-in-south-region">Key Indicators of SE Factors in South Region</h2>
<p><img src="images/clipboard-931929066.png" class="img-fluid"></p>
<p>Based on the distributions, high skill employment is the most normal. This indicates a moderate level of high skilled employment across the region. As a result, high skilled employment does not seem to have any major impact on the z-score since regions with disproportionately low levels of high skilled employment may experience higher levels of socioeconomic challenges. A skewed distribution such as employment rate stands out as a variable that heavily impacts the z-score. Employment rate is skewed to the left. The distribution suggests that a significant proportion of the population is employed and the Northeast region has a robust economy. Although poverty rate, housing vacancy rate, and public assistant rate are skewed right shows that most areas in the Northeast have low instances of these cases. This aligns with our Distribution by Average z-score by Region table which shows Northeast with the highest scores.</p>
<p>The South region follows the same pattern as the Northeast region. From analyzing the employment rate visual, the concentration of employment could also suggest challenges for unemployed individuals. This could potentially lead to issues such as income inequality. This is evident in the right skewed distribution of the median housing income graph. It shows that most of the population earns a lower income. This could be the reason the South region has a significantly lower z-score than the Northeast.</p>
<p>In order to determine which variable has the highest impact on the dependent variable (z_COI_nat), we decided to run a regression to examine the magnitude of the coefficients. The larger the absolute value of the coefficient, the stronger the impact of that variable on the dependent variable, holding other variables constant. Looking at the coefficients, the variable <code>employ_rate</code> has the largest (absolute value) coefficient, with an estimate of 8.193e-04. This suggests that for every unit increase in the employment rate, the z_COI_nat increases by approximately 8.193e-04 units, assuming all other variables remain constant. Additionally, <code>med_house_income</code> also has a substantial coefficient (1.676e-07), indicating that for every unit increase in median household income, the z_COI_nat increases by approximately 1.676e-07 units, holding other variables constant. This confirms our interpretations of the histograms for why Northeast has the highest z-scores and why South has the lowest.</p>
</section>
<section id="linear-models-for-weighted-average-of-social-and-economic-domain-z-scores-nationally-normed" class="level2">
<h2 class="anchored" data-anchor-id="linear-models-for-weighted-average-of-social-and-economic-domain-z-scores-nationally-normed">Linear Models for Weighted Average of Social and Economic Domain z-scores, Nationally Normed</h2>
<p><img src="images/clipboard-434729416.png" class="img-fluid"></p>
<p>Residuals vs Fitted Plot: This plot helps to check the assumption of linearity and homoscedasticity in a regression model. Ideally, the residuals will be randomly distributed to indicate a good model fit. Here, the residuals seem to be relatively evenly distributed around the horizontal line, but a slight fan shape suggests potential heteroscedasticity, where the variance of the residuals increases as the fitted values increase.</p>
<p>Normal Q-Q Plot: This plot is used to check the normality of residuals. The points should lie approximately along the reference line if the residuals are normally distributed. In this plot, most points align well with the line except for a slight deviation at the tails. This suggests that the residuals are mostly normal but with some possible deviations from normality at the extremes.</p>
<p>Scale-Location Plot: Similar to the first plot, this one also checks for homoscedasticity by plotting the square roots of the standardized residuals against the fitted values. The relatively constant spread across the range of fitted values suggests that variance is fairly constant (homoscedasticity), although, like the Residuals vs Fitted plot, there appears to be a slight increase in spread for higher fitted values. Another similarity is the presence of outliers, which suggest atypical levels of heteroscedasticity for those points.</p>
<p>Cook’s Distance Plot: This plot shows the influence of each observation on the fitted values. Observations with a Cook’s distance much larger than others can be considered influential to the model. Here, all observations have relatively low Cook’s distances, suggesting that no single observation is overly influential. Overall, the model shows a reasonable fit with some signs of potential heteroscedasticity and slight deviations from normality at the extremes. The lack of influential outliers is a good sign for the robustness of the model.</p>
</section>
</section>
<section id="education-domain-factors" class="level1">
<h1>Education Domain Factors</h1>
<section id="key-indicators-of-ed-factors-in-northeast-region" class="level2">
<h2 class="anchored" data-anchor-id="key-indicators-of-ed-factors-in-northeast-region">Key Indicators of ED Factors in Northeast Region</h2>
</section>
<section id="key-indicators-of-ed-factors-in-south-region" class="level2">
<h2 class="anchored" data-anchor-id="key-indicators-of-ed-factors-in-south-region"><img src="images/clipboard-764707238.png" class="img-fluid">Key Indicators of ED Factors in South Region</h2>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"><img src="images/clipboard-123417509.png" class="img-fluid"></h2>
<p>Analyzing the histograms of key education indicators for the Northeast and South regions, several patterns emerge that align with broader socioeconomic trends and disparities between these areas.</p>
<p>In the Northeast, histograms such as adult education attainment, college enrollment, and education centers suggest a robust educational infrastructure with moderate to high levels of engagement and attainment. For instance, the distribution of adult education attainment and college enrollment both exhibit a normal-like distribution, centered around moderate levels. This indicates a balanced distribution of educational levels, which likely contributes to a stronger economy and higher employment rates. The histogram for education centers, which is slightly skewed towards higher numbers, further supports the availability of educational resources. Such distributions align with a more robust economic environment where higher education levels and resource availability contribute positively to socioeconomic stability.</p>
<p>Conversely, the South shows a different pattern. The histograms for the same indicators display significant right skewness, especially in math proficiency and school poverty rates. These distributions suggest lower levels of achievement and higher instances of poverty within schools. The histogram for adult education attainment in the South also shows a pronounced decline as educational levels increase, indicating fewer adults achieve higher education levels. These educational challenges are mirrored in socioeconomic conditions, as reflected by lower median household incomes and a higher percentage of school-associated poverty.</p>
<p>Building on the examination of educational indicators using histographs, we conducted a regression analysis to determine which variables significantly impact the dependent variable (z_COI_nat). Among the independent variables, the variable <code>prop_nonwhite</code> exhibits the most significant impact with a coefficient of -0.02019, indicating that a unit increase in the proportion of the nonwhite population is associated with a decrease of approximately 0.02019 in the z_COI_nat, holding other variables constant. Similarly, the variable <code>school_pov</code> has a substantial negative coefficient of -0.0002494, suggesting that an increase in the school poverty rate by one unit leads to a decrease in z_COI_nat by roughly the same magnitude. In contrast, variables such as <code>HS_gradrate</code> and <code>adult_edu_attainment</code>, with coefficients of 0.0001139 and 0.0006891 respectively, show that higher levels of educational attainment correspond to positive increments in z_COI_nat.</p>
</section>
<section id="linear-models-for-weighted-average-of-education-domain-z-scores-nationally-normed" class="level2">
<h2 class="anchored" data-anchor-id="linear-models-for-weighted-average-of-education-domain-z-scores-nationally-normed">Linear Models for Weighted Average of Education Domain z-scores, Nationally Normed</h2>
<p><img src="images/clipboard-1640644644.png" class="img-fluid"></p>
<p>Residuals vs Fitted Plot: This plot helps to check the assumption of linearity and homoscedasticity in a regression model. Ideally, the residuals will be randomly distributed to indicate a good model fit. In this plot, the residuals appear to be somewhat randomly distributed, although there is a slight pattern indicating potential non-linearity or heteroscedasticity, where variances of residuals are not constant across the range of fitted values.</p>
<p>Normal Q-Q Plot: This plot helps assess whether the residuals are normally distributed, a key assumption in linear regression. The points in this plot follow the theoretical line closely in the central part but deviate slightly in the tails, suggesting some light deviations from normality, particularly with extreme values, which could be outliers or influential points affecting the regression model.</p>
<p>Scale-Location Plot: This plot also checks for homoscedasticity by plotting the square roots of the standardized residuals against the fitted values. If the variances of residuals are equal across all levels of the independent variables (homoscedasticity), the spread of residuals in this plot should be roughly constant across the range of fitted values. Here, the plot shows a cluster of points with a fairly consistent spread, suggesting that our model meets the assumption of equal variance reasonably well.</p>
<p>Cook’s Distance Plot: This plot identifies influential cases that might overly influence the regression model. Points with a Cook’s distance greater than a critical value (commonly 1 or 0.5) are considered potentially influential. The plot here shows most data points have low Cook’s distances, indicating that no single observation overly influences the overall model fit.</p>
</section>
</section>
<section id="health-and-environment-factors" class="level1">
<h1>Health and Environment Factors</h1>
<section id="key-indicators-of-he-factors-in-northeast-region" class="level2">
<h2 class="anchored" data-anchor-id="key-indicators-of-he-factors-in-northeast-region">Key Indicators of HE Factors in Northeast Region</h2>
<p><img src="images/clipboard-2549282257.png" class="img-fluid"></p>
</section>
<section id="key-indicators-of-he-factors-in-south-region" class="level2">
<h2 class="anchored" data-anchor-id="key-indicators-of-he-factors-in-south-region">Key Indicators of HE Factors in South Region</h2>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"><img src="images/clipboard-2315424768.png" class="img-fluid"></h2>
<hr>
<p>As we take a closer look at the distribution of Key health and Economics indicators. The histograms for the Northeast region and the South region display a similar pattern. Based on the distribution of Key Health and However, there is a significant disparity between those two regions in terms of airborne micro particles factor. In the south region the distribution of this variable is more normal than the northeast region. Indicating the seasonality differences between those regions. On the other hand, the heat exposure distribution of the 2 regions also suggests a significant difference. As we noted, the attainment to health insurance is highly left skewed for both region. This skewed distribution suggests that the variable has a significant impact on the z score. For the green space access, the south region has higher variance than the northeast region suggesting that the green space access may be considered as a more influential factor in northeast region</p>
</section>
<section id="linear-models-for-weighted-average-of-health-and-economic-domain-z-scores-nationally-normed" class="level2">
<h2 class="anchored" data-anchor-id="linear-models-for-weighted-average-of-health-and-economic-domain-z-scores-nationally-normed">Linear Models for Weighted Average of Health and Economic Domain z-scores, Nationally Normed</h2>
<p><img src="images/clipboard-3670613666.png" class="img-fluid"></p>
<p>Residuals vs Fitted Plot: The plot is used to exam the linearity and homoscedasticity. Based on the graph presented, there is no unequal variance. However, there are some of points that lies outside of the plot, suggesting possible outliers.</p>
<p>Normal N-Q-Q Plot: This plot is used to test the residuals, as we can see from the graph the N-Q-Q plot for the health and environment domain, most of the cloud point lies on the line, suggesting a normal distribution.</p>
<p>Scale - Location Plot: Despite of some obvious outliers, the plot displays a constant spread across the plot, indicating homoscedasticity. We can see a horizontal line with equally random point, suggesting our model’s robustness.</p>
<p>Cook Distance Plot: For detecting influential observations, we use cook distance plot, as we can see from the plot, the overall cook distance is small indicating that there is no potential strongly influential observations. At the same time, the plot prove the homoscedasticity and no obvious outliers for the health and environment domain.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>